<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Happy Birthday!</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Great+Vibes&family=Playfair+Display:ital,wght@0,700;1,700&family=Montserrat:wght@300;400;600&display=swap');
    
    html { scroll-behavior: smooth; overflow-x: hidden; }
    
    body { 
      font-family: 'Montserrat', sans-serif; 
      background: #020617;
      color: #f8fafc; 
      min-height: 100vh;
      margin: 0;
      transition: background 1s ease;
      -webkit-tap-highlight-color: transparent; 
    }

    body.mood-midnight { background: radial-gradient(circle at center, #1e1b4b 0%, #020617 100%); }
    body.mood-lover { background: radial-gradient(circle at center, #450a0a 0%, #170303 100%); }

    #balloon-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }

    .glass { 
      backdrop-filter: blur(40px); 
      background: rgba(255, 255, 255, 0.08); 
      border: 1px solid rgba(255, 255, 255, 0.2); 
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7);
      border-radius: 3.5rem; 
    }

    .birthday-title { 
      font-family: 'Great Vibes', cursive; 
      font-size: clamp(3.5rem, 12vw, 7rem); 
      background: linear-gradient(180deg, #ffffff 0%, #fde68a 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,0.4));
      line-height: 1.1;
    }

    /* 3D FLIP LOGIC */
    .photo-container { perspective: 1000px; width: 170px; height: 210px; cursor: pointer; }
    .photo-inner {
      position: relative; width: 100%; height: 100%;
      transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      transform-style: preserve-3d;
    }
    .photo-container.flipped .photo-inner { transform: rotateY(180deg); }

    .photo-front, .photo-back {
      position: absolute; width: 100%; height: 100%;
      backface-visibility: hidden;
      background: white; border-radius: 0.5rem;
      padding: 10px 10px 40px 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
    .photo-back {
      transform: rotateY(180deg);
      display: flex; align-items: center; justify-content: center;
      text-align: center; color: #1e293b; font-family: 'Great Vibes', cursive;
      font-size: 1.4rem; padding: 20px;
    }
    .photo-front img { width: 100%; height: 150px; object-fit: cover; border-radius: 0.2rem; }

    .editorial-heading { font-family: 'Playfair Display', serif; font-weight: 700; font-style: italic; color: #fef3c7; }
    .body-serif { font-family: 'Playfair Display', serif; font-size: 1.25rem; color: #e2e8f0; line-height: 1.8; }

    /* CAKE & CANDLE PHYSICS */
    .cake-wrapper { position: relative; width: 260px; height: 220px; display: flex; flex-direction: column; align-items: center; justify-content: flex-end; }
    .tier-container { position: relative; width: var(--w); height: var(--h); margin-bottom: 2px; display: flex; }
    
    .tier-top .tier-half { background: #fcd34d; } 
    .tier-middle .tier-half { background: #2dd4bf; } 
    .tier-bottom .tier-half { background: #db2777; } 

    .tier-half { width: 50%; height: 100%; border-top: 5px solid rgba(255,255,255,0.3); transition: all 1s cubic-bezier(0.4, 0, 0.2, 1); }
    .left-half { border-radius: 1.5rem 0 0 0.5rem; }
    .right-half { border-radius: 0 1.5rem 0.5rem 0; }
    
    /* Candle Grouping */
    .candle-container { position: absolute; bottom: 195px; width: 100%; display: flex; justify-content: center; gap: 20px; z-index: 50; transition: all 0.8s ease; }
    
    /* Animation when cut */
    .is-cut .left-half { transform: translateX(-150px) rotate(-25deg); opacity: 0; }
    .is-cut .right-half { transform: translateX(150px) rotate(25deg); opacity: 0; }
    .is-cut .candle-container { opacity: 0; transform: translateY(-40px); pointer-events: none; }

    .candle { width: 8px; height: 35px; background: linear-gradient(to right, #fde68a, #f59e0b); border-radius: 4px; position: relative; }
    .flame { width: 14px; height: 24px; background: radial-gradient(#fff, #fb923c, #ef4444); border-radius: 50% 50% 20% 20%; box-shadow: 0 0 20px #fb923c; animation: flicker 0.15s infinite alternate; }
    .flame.out { display: none; }
    
    @keyframes flicker { from { transform: scale(1); } to { transform: scale(1.1); } }
    .step { display: none; opacity: 0; transform: scale(0.95); transition: 0.8s ease; width: 100%; }
    .step-active { display: flex !important; opacity: 1; transform: scale(1); }
    .pill-button { padding: 1.25rem 3rem; border-radius: 9999px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.15em; font-size: 0.7rem; z-index: 10; cursor: pointer; }
  </style>
</head>
<body class="mood-midnight">

<canvas id="balloon-canvas"></canvas>

<div class="fixed top-8 left-8 z-[60] flex gap-4">
    <button onclick="toggleMood()" class="p-4 glass rounded-full shadow-2xl active:scale-90 transition group">
        <i id="moodIcon" data-lucide="moon" class="text-white group-hover:text-amber-200"></i>
    </button>
</div>

<div class="fixed top-8 right-8 z-[60]">
    <button onclick="toggleMusic()" class="p-4 glass rounded-full shadow-2xl active:scale-90 transition">
        <i id="musicIcon" data-lucide="volume-x" class="text-white"></i>
    </button>
</div>

<audio id="bgMusic" loop preload="auto">
    <source src="https://files.catbox.moe/0v2vzn.mp3" type="audio/mpeg">
</audio>

<main class="relative z-10 min-h-screen flex flex-col items-center justify-center p-4">
    <div id="main-card" class="glass p-10 md:p-14 max-w-2xl w-full flex flex-col items-center shadow-2xl overflow-hidden relative">
        
        <div id="step-1" class="step step-active flex-col items-center text-center">
            <h1 class="birthday-title mb-8">Happy Birthday</h1>
            
            <div class="relative h-72 w-full flex justify-center items-center gap-4 mb-10">
                <div class="photo-container" onclick="this.classList.toggle('flipped')" style="transform: rotate(-5deg);">
                    <div class="photo-inner">
                        <div class="photo-front"><img src="https://images.unsplash.com/photo-1513151233558-d860c5398176?w=400"></div>
                        <div class="photo-back">To the girl who brightens every room.</div>
                    </div>
                </div>
                <div class="photo-container" onclick="this.classList.toggle('flipped')" style="transform: rotate(5deg);">
                    <div class="photo-inner">
                        <div class="photo-front"><img src="https://images.unsplash.com/photo-1464349153735-7db50ed83c84?w=400"></div>
                        <div class="photo-back">You are pure magic, Aarohi.</div>
                    </div>
                </div>
            </div>
            <p class="text-[10px] uppercase tracking-widest opacity-50 mb-8">Tap photos to reveal secrets</p>
            <button onclick="startExperience()" class="pill-button bg-white text-slate-900 shadow-lg hover:scale-105 active:scale-95">Enter Her World</button>
        </div>

        <div id="step-2" class="step flex-col items-center text-center">
            <h2 class="editorial-heading text-4xl mb-8">Grace & Radiance</h2>
            <div id="scratch-area" class="relative w-[280px] h-[100px] rounded-[2rem] overflow-hidden border-2 border-amber-200/30 mb-12">
                <div class="absolute inset-0 flex items-center justify-center bg-slate-900 font-['Great_Vibes'] text-2xl text-amber-200">One of One.</div>
                <canvas id="scratch-canvas" class="absolute inset-0 z-10 touch-none cursor-crosshair"></canvas>
            </div>
            <button onclick="handleStep(3)" class="pill-button bg-indigo-600 text-white">The Birthday Wish âž”</button>
        </div>

        <div id="step-3" class="step flex-col items-center pt-16">
            <div class="cake-wrapper" id="cake-container">
                <div class="candle-container">
                    <div onclick="extinguish(this)" class="cursor-pointer"><div class="candle"><div class="flame absolute -top-4 -left-1"></div></div></div>
                    <div onclick="extinguish(this)" class="cursor-pointer"><div class="candle"><div class="flame absolute -top-4 -left-1"></div></div></div>
                </div>
                
                <div class="tier-container tier-top" style="--w:100px; --h:55px; z-index:3"><div class="tier-half left-half"></div><div class="tier-half right-half"></div></div>
                <div class="tier-container tier-middle" style="--w:180px; --h:65px; z-index:2"><div class="tier-half left-half"></div><div class="tier-half right-half"></div></div>
                <div class="tier-container tier-bottom" style="--w:240px; --h:75px; z-index:1"><div class="tier-half left-half"></div><div class="tier-half right-half"></div></div>
            </div>
            <div class="mt-14 text-center">
                <h3 class="editorial-heading text-2xl mb-2">Manifesting Greatness</h3>
                <button id="cut-btn" class="hidden mt-6 pill-button bg-white text-slate-900 animate-bounce" onclick="cutCake()">Slice & Celebrate</button>
            </div>
        </div>
    </div>

    <div id="final-msg" class="w-full max-w-xl mt-24 hidden flex-col gap-10 pb-32">
        <h3 class="birthday-title text-center !text-5xl">Unforgettable</h3>
        <div class="p-8 glass !rounded-[2.5rem] border-l-4 border-amber-200 text-center">
            <p class="body-serif">"It's your birthday, it's your birthday..."<br>May your year be filled with big wins and radiant energy.</p>
        </div>
        <button onclick="location.reload()" class="self-center text-amber-200/40 uppercase tracking-[0.3em] text-[8px] font-bold">Replay</button>
    </div>
</main>

<script>
    lucide.createIcons();
    const bgMusic = document.getElementById('bgMusic');
    let flamesOut = 0;

    function toggleMood() {
        const body = document.body;
        const icon = document.getElementById('moodIcon');
        if(body.classList.contains('mood-midnight')) {
            body.className = 'mood-lover';
            icon.setAttribute('data-lucide', 'heart');
        } else {
            body.className = 'mood-midnight';
            icon.setAttribute('data-lucide', 'moon');
        }
        lucide.createIcons();
    }

    function startExperience() {
        bgMusic.volume = 0.4; bgMusic.play();
        document.getElementById('musicIcon').setAttribute('data-lucide', 'volume-2');
        lucide.createIcons();
        handleStep(2);
    }

    function handleStep(n) {
        document.querySelectorAll('.step').forEach(s => s.classList.remove('step-active'));
        document.getElementById(`step-${n}`).classList.add('step-active');
        if(n === 2) initScratch();
    }

    function extinguish(el) {
        const f = el.querySelector('.flame');
        if(!f.classList.contains('out')) {
            f.classList.add('out');
            flamesOut++;
            confetti({ particleCount: 20, origin: { y: 0.7 } });
            if(flamesOut >= 2) document.getElementById('cut-btn').classList.remove('hidden');
        }
    }

    function cutCake() {
        // Trigger the animation class on the container
        const cake = document.getElementById('cake-container');
        cake.classList.add('is-cut');
        
        confetti({ 
            particleCount: 150, 
            spread: 70, 
            origin: { y: 0.7 },
            colors: ['#fcd34d', '#2dd4bf', '#db2777']
        });

        setTimeout(() => {
            document.getElementById('final-msg').style.display = 'flex';
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }, 1000);
    }

    function initScratch() {
        const canvas = document.getElementById('scratch-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 280; canvas.height = 100;
        ctx.fillStyle = '#1e293b'; ctx.fillRect(0,0,280,100);
        ctx.globalCompositeOperation = 'destination-out';
        const draw = (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = (e.pageX || e.touches[0].pageX) - rect.left - window.scrollX;
            const y = (e.pageY || e.touches[0].pageY) - rect.top - window.scrollY;
            ctx.beginPath(); ctx.arc(x, y, 25, 0, Math.PI*2); ctx.fill();
        };
        canvas.onmousemove = draw; canvas.ontouchmove = draw;
    }

    function toggleMusic() {
        if (bgMusic.paused) bgMusic.play(); else bgMusic.pause();
        document.getElementById('musicIcon').setAttribute('data-lucide', bgMusic.paused ? 'volume-x' : 'volume-2');
        lucide.createIcons();
    }

    // Balloon Animation
    const bCanvas = document.getElementById('balloon-canvas');
    const bCtx = bCanvas.getContext('2d');
    function resize() { bCanvas.width = window.innerWidth; bCanvas.height = window.innerHeight; }
    window.onresize = resize; resize();
    let balloons = [];
    class Balloon {
        constructor() { this.reset(); this.y = Math.random() * bCanvas.height; }
        reset() { this.x = Math.random() * bCanvas.width; this.y = bCanvas.height + 100; this.speed = 1 + Math.random() * 2; }
        draw() {
            this.y -= this.speed; if(this.y < -100) this.reset();
            bCtx.globalAlpha = 0.15; bCtx.fillStyle = '#ffffff';
            bCtx.beginPath(); bCtx.arc(this.x, this.y, 20, 0, Math.PI*2); bCtx.fill();
        }
    }
    for(let i=0; i<15; i++) balloons.push(new Balloon());
    function anim() { bCtx.clearRect(0,0,bCanvas.width, bCanvas.height); balloons.forEach(b => b.draw()); requestAnimationFrame(anim); }
    anim();
</script>
</body>
</html>